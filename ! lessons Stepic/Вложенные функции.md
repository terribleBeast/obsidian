https://stepik.org/lesson/651459/step/1?discussion=6018467&unit=648165
https://stepik.org/lesson/651459/step/14?discussion=7979732&unit=648165

## Вложенные функции 

``` python
def speak(text): 
    def whisper(t): # объявляем вложенную функцию 
        return t.lower() + '...' 
    return whisper(text) # вызываем вложенную функцию и возвращаем ее результат 
    
print(speak('Hello, World'))
```

Если нам нужно получить доступ к функции `whisper` извне, то мы можем вернуть её вызывающей стороне.

## Замыкания 


Замыкания - особый вид функции, которая определена в теле другой функции и создается каждый раз во время её выполнения. Синтаксически: функция, определенная внутри другой функции, при этом вложенная функция содержит ссылки на локальные переменные внешней функции. Каждый раз при выполнении внешней функции происходит создание нового экземпляра внутренней функции, с новыми ссылками на переменные внешней функции. 




``` python
def line_generator(k, b): 
    def func(x): 
    return k * x + b 
return func
```

Вложенные функции могут обращаться ко всем переменным из вышестоящих областей видимости, но изменять их не могут. 
**Локальные переменные** - переменные объявленные в области видимости.

Поиск переменной по имени переменной:
1. поиск в локальной области видимости
2. ищем нелокальную
3. ищем глобальную
4. встроенную в язык 

Для изменения нелокальных переменных используется ключевое слово `nonlocal`
``` python
def outer_function(): 
    num = 5 
    def inner_function(): # определяем вложенную функцию 
        nonlocal num 
        num += 10 
        print(num) 
    inner_function() # вызываем вложенную функцию 

outer_function()
```

## Атрибут `__closure__`

Все функции содержат специальный атрибут `__closure__`, который представляет из себя кортеж, содержащий данные, связанные с вложенными областями видимости, то есть с нелокальными переменными,
``` python
def outer_function(arg): 
    num = 5 
    name = 'Timur' n
    umbers = [1, 2, 3] 
    def inner_function(): # определяем вложенную функцию 
        print(arg) 
        print(num) 
    return inner_function # возвращаем вложенную функцию 
inner = outer_function('python') 

for var in inner.__closure__: 
    print(var.cell_contents)
# python
# 5
```
Кортеж `__closure__` содержит внутри себя специальный тип данных. Для получения самого значения используем атрибут `cell_contents`.

Использование замыканий:
- избегания жестко закодированнных констант
- воздержание от использования глобальных пременных
- воздержание от создания ненужных типов данных (классов)
- замыкания применяются в [декораторах](Декораторы.md)
- сокрытие данных (данных, которые требуются лишь для вызова вложенной функции)